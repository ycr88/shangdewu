{% set post = page.header %}
{% set metadata = []%}
{% set description = post.description ?: page.summary ?: post.subheading %}
{% set DEFAULT_IMAGE_PATH = "/blog/default.jpg" %}
{#open graph#}
{#title#}
{% if post.title %}
{% set length = post.title | length %}
{% set long_title = post.title | upper ~" | "~ post.subheading ?: description| truncate(300 - length) %}
{% set metadata = metadata | merge([{"property":"og:title","content":long_title | striptags}]) %}
{% endif %}
{#type#}
{% set TYPE_DEFAULT = "article" %}
{% if not post.metadata.og-type  %}
  {% set  type = post.metadata.type ?: TYPE_DEFAULT %}
  {% set metadata = metadata | merge([{"property":"og:type","content": type }]) %}
{% endif %}
{# URL #}
{% set metadata = metadata["og:url"] ?: metadata | merge([{"property":"og:url","content": page.url(true) }]) %}
{# description#}
{# NOTE description expect a header description #}
{% set description = post.description ?: page.summary ?: post.subheading %}
{% if description %}
{% set metadata = metadata | merge([{"property":"og:description","content": description | striptags }]) %}
{% endif %}
{# image #}
  {# NOTE in the header facebookimage can accept values :
    name.ext of local image
    or a url to exernalimage #}
    {# TODO
      - [x] add metadata for facebook if not exit aldeady og:image from headear metadata
      - [ ] use the image with the correct dimension.
      - [x] verify is working the fallback to default image
      #}
{% set facebookimage = page.media['facebook-image.jpg'] ? 'facebook-image.jpg' : post.facebookimage %}{#// get the image to facebook #}
{% if facebookimage %}
  {% set is_url = ["www.","http://","://"] %}
  {% set image = page.media['facebook-image.jpg'] ? page.url(true) ~"/"~ 'facebook-image.jpg' : null %}
  {% for arg in is_url if not image %}
    {% if arg in facebookimage %}
      {% set image = facebookimage %}
    {% endif %}
  {% endfor %}
  {% set image = image ?: page.url(true) ~"/"~ facebookimage %}
{% endif %}
{% if not image %}
  {% set image = post.header_image ? page.url(true) ~"/"~ post.header_image : base_url_absolute ~ DEFAULT_IMAGE_PATH %}
{% endif %}
{% set metadata = metadata | merge([{"property":"og:image","content": image }]) %}
{#end#}
{# TODO vk,instagram,twiter,viber card#}
{% for meta in metadata %}
<meta {% if meta.name %}name="{{ meta.name }}" {% endif %}{% if meta.http_equiv %}http-equiv="{{ meta.http_equiv }}" {% endif %}{% if meta.charset %}charset="{{ meta.charset }}" {% endif %}{% if meta.property %}property="{{ meta.property }}" {% endif %}{% if meta.content %}content="{{ meta.content }}" {% endif %}/>
{% endfor %}
